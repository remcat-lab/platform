### π” λ°±μ—… νλ¦„ (ν΄λΌμ΄μ–ΈνΈ μ¤‘μ‹¬)

1. **ν΄λΌμ΄μ–ΈνΈ**μ—μ„ λ°±μ—… μ ν‹Έλ¦¬ν‹° μ‹¤ν–‰ (with `ProjectId`, `λ€μƒ ν΄λ”`)
2. **μ„λ²„**μ— `ProjectId`λ΅ κ°€μ¥ μµμ‹  Commit μ”μ²­
3. **μ„λ²„ μ‘λ‹µ**: Commitμ— ν¬ν•¨λ μ „μ²΄ νμΌ metadata (full path, mtime, size)
4. **ν΄λΌμ΄μ–ΈνΈμ—μ„ ν„μ¬ νμΌ μ‹μ¤ν… μƒνƒμ™€ λΉ„κµ**
   - λ³€κ²½λ νμΌ (mtime/size λ‹¤λ¦„)
   - μ¶”κ°€λ νμΌ (κ²½λ΅ μ—†μ)
5. **λ³€κ²½/μ¶”κ°€ νμΌλ“¤κ³Ό κ·Έ metadata**λ¥Ό tar.gzλ΅ μ••μ¶•
6. μ„λ²„μ— μ „μ†΅
7. **μ„λ²„λ” metadata + hash λΉ„κµλ΅ μ¤‘λ³µ μ κ±° ν›„ DB μ €μ¥**

---

## β… μ΄ κµ¬μ΅°μ μ¥μ 

### 1. π§  **ν΄λΌμ΄μ–ΈνΈκ°€ λ” λ§μ€ λ¬Έλ§¥μ„ μ•κ³  μμ**
- μ „μ²΄ νμΌ μ‹μ¤ν…μ„ μ§μ ‘ μ ‘κ·Ό κ°€λ¥ β†’ `mtime`, `size`, `existence` μ‰½κ² ν™•μΈ
- λ³€κ²½λ νμΌ μ—¬λ¶€λ¥Ό **μ„λ²„κ°€ μ¶”λ΅ ν•  ν•„μ” μ—†μ** β†’ μ„λ²„λ” λ‹¨μ μμ‹ μ²λ¦¬λ§ ν•λ©΄ λ¨

### 2. π€ **μ„±λ¥ μµμ ν™”κ°€ μ‰¬μ›€ (Rust ν™μ©)**
- ν΄λΌμ΄μ–ΈνΈλ” λ©€ν‹°μ¤λ λ“λ΅ νμΌ νƒμƒ‰, λ©”νƒ€λ°μ΄ν„° μ¶”μ¶, ν•΄μ‹ κ³„μ‚°μ„ λ³‘λ ¬ μ²λ¦¬ κ°€λ¥
- Rustμ `rayon`, `walkdir`, `flate2` λ“± μ‚¬μ© μ‹ κ³ μ† μ²λ¦¬

### 3. β™οΈ **κµ¬μ΅°κ°€ λ‹¨μν•΄μ§ (λΉ„μ¦λ‹μ¤ λ΅μ§ λ¶„λ¦¬)**
- μ„λ²„λ” dumb storage μ—­ν• μ— μ§‘μ¤‘ (metadata μ €μ¥, μ¤‘λ³µ μ κ±°, μ‘λ‹µ)
- λ³µμ΅ν• λ³€κ²½ κ°μ§€/λΉ„κµ λ΅μ§μ€ ν΄λΌμ΄μ–ΈνΈμ— μμ β†’ **μ—­ν•  λ¶„λ¦¬λ΅ μ μ§€λ³΄μ μ‰¬μ›€**

### 4. π§ **ν…μ¤νΈ λ° λ””λ²„κΉ… μ©μ΄**
- μ„λ²„μ— λ¬Έμ  μƒκ²Όμ„ λ• ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ κ²ƒλ§ λ³΄λ©΄ λ¨ (tar.gz + metadata)
- ν΄λΌμ΄μ–ΈνΈλ” ν…μ¤νΈμ‹ λ΅μ»¬μ—μ„ metadata diffλ§ ν•΄λ„ λ™μ‘ ν™•μΈ κ°€λ¥

### 5. π’΅ **μ¦λ¶„ λ°±μ—… κµ¬ν„μ΄ λ…ν™•ν•΄μ§**
- ν΄λΌμ΄μ–ΈνΈκ°€ μ§μ „ μƒνƒλ¥Ό λ…ν™•ν μ•κ³  μμΌλ―€λ΅ μ–΄λ–¤ νμΌμ΄ λ³€ν™”ν–λ”μ§€ μ •ν™•ν νλ‹¨ κ°€λ¥
- μ„λ²„λ” μλ™ λΉ„κµ, μ¬μ”μ²­, μ»¤λ°‹ μƒνƒ λΉ„κµ λ“±μ„ ν•μ§€ μ•μ•„λ„ λ¨

---

## π§± μ‹μ¤ν… κµ¬μ΅° λΉ„κµ

| ν•­λ© | μ„λ²„ μ¤‘μ‹¬ λ°©μ‹ | ν΄λΌμ΄μ–ΈνΈ μ¤‘μ‹¬ λ°©μ‹ (μ μ•ν• λ°©μ‹) |
|------|----------------|----------------------------------|
| λ³€κ²½ νμΌ νλ‹¨ | μ„λ²„κ°€ μ¶”λ΅  | ν΄λΌμ΄μ–ΈνΈκ°€ μ •ν™•ν νλ‹¨ |
| μ „μ†΅ λ°μ΄ν„° | λ³€κ²½λμ§€ λ¨λ¥΄λ” μ „μ²΄ νμΌ/μ‹κ°„ κΈ°λ° μ¶”μ • | λ³€κ²½λ νμΌκ³Ό μ •ν™•ν• metadata |
| μ„λ²„ λ¶€λ‹΄ | λΉ„κµ λ΅μ§, μ¬μ”μ²­ λ“± λ΅μ§ λ³µμ΅ | μμ‹  λ° μ €μ¥ μ¤‘μ‹¬ |
| λ™κΈ°ν™” μ •ν™•λ„ | mtime λ„λ½ κ°€λ¥μ„± μμ | full metadata diffλ΅ μ •ν™• |
| ν™•μ¥μ„± | μ„λ²„ μ½ λ¶€ν•κ°€ μ§‘μ¤‘ | ν΄λΌμ΄μ–ΈνΈ λ¶„μ‚° μ²λ¦¬ |
| μ½”λ“ κµ¬μ΅° | λ΅μ§ λ¶„μ‚°, μƒνƒ κ΄€λ¦¬ λ³µμ΅ | μ—­ν•  λ…ν™•ν λ¶„λ¦¬λ¨ |
| μ¶”ν›„ κΈ°λ¥ ν™•μ¥ | μ–΄λ µκ³  μ¶©λ μ°λ ¤ | μ μ—°ν• λ²„μ „ κ΄€λ¦¬ λ° κΈ°λ¥ ν™•μ¥ μ©μ΄ |

---

## π”§ μ„¤κ³„ ν

1. ν΄λΌμ΄μ–ΈνΈμ—μ„ metadata μ¶”μ¶ μ‹:
   - full path, size, mtime μ™Έμ— μ„ νƒμ μΌλ΅ `partial hash`λ¥Ό μ¶”κ°€ν•΄λ„ μΆ‹μ
2. μ„λ²„ μ‘λ‹µμ commit metadataλ” gzip λ“±μΌλ΅ μ••μ¶•ν•΄μ„ λ‚΄λ ¤λ„ λ¬΄λ°© (μ „μ†΅ μµμ ν™”)
3. metadataλ” μ •λ ¬ν•΄μ„ λ³΄λ‚΄λ©΄ μ„λ²„μ—μ„λ„ μ¤‘λ³µ λΉ„κµ/κΈ°λ΅μ΄ λ” κ°„νΈ
4. μ„λ²„μ—μ„λ” λ™μΌ νμΌμ€ `hash`λ΅ deduplication, λ™μΌ metadataλ” λ²„μ „ κ΄€λ¦¬ ν•νƒλ΅ μ €μ¥

---

## β… κ²°λ΅ 

> μ§€κΈ μ μ•ν• κµ¬μ΅°λ” **λ” λ‹¨μν•κ³ , μ‹ λΆ°μ„± μκ³ , ν™•μ¥μ„± μλ” λ°±μ—… κµ¬μ΅°μ…λ‹λ‹¤.**

- ν΄λΌμ΄μ–ΈνΈκ°€ μƒνƒ νλ‹¨μ„ μ±…μ„μ§€κ³ 
- μ„λ²„λ” μμ‹ κ³Ό μ €μ¥μ— μ§‘μ¤‘ν•λ” λ°©μ‹μ€
- μ‹¤μ  λ°±μ—… μ†”λ£¨μ… (μ: restic, borg, duplicity λ“±)μ—μ„λ„ μ‚¬μ©ν•λ” κµ¬μ΅°μ…λ‹λ‹¤.

---


``` mermaid
flowchart TD
    subgraph Client
        A1[λ°±μ—… ν”„λ΅κ·Έλ¨ μ‹μ‘<br/>ProjectIdμ™€ ν΄λ” μ •λ³΄ μ„λ²„λ΅ μ „μ†΅]
        A2[μ„λ²„λ΅λ¶€ν„° μµκ·Ό Commitμ<br/>μ „μ²΄ νμΌ metadata μμ‹ ]
        A3[λ΅μ»¬ ν΄λ” μ¤μΊ”ν•μ—¬ ν„μ¬ metadata μ¶”μ¶]
        A4[μ„λ²„ metadataμ™€ λΉ„κµν•μ—¬<br/>λ³€κ²½ λ° μ¶”κ°€λ νμΌ λ©λ΅ μƒμ„±]
        A5[λ³€κ²½/μ¶”κ°€ νμΌκ³Ό metadataλ¥Ό<br/>tar.gzλ΅ μ••μ¶•]
        A6[tar.gzμ™€ metadataλ¥Ό μ„λ²„μ— μ „μ†΅]
    end

    subgraph Server
        B1[tar.gz λ° metadata μμ‹ ]
        B2[νμΌ ν•΄μ‹ κ³„μ‚° λ° μ¤‘λ³µ μ κ±°]
        B3[μƒλ΅μ΄ νμΌκ³Ό metadata DBμ— μ €μ¥]
        B4[Commit μ •λ³΄ μ—…λ°μ΄νΈ]
    end

    A1 --> A2 --> A3 --> A4 --> A5 --> A6 --> B1 --> B2 --> B3 --> B4


```
