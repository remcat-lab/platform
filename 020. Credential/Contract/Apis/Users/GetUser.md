
# GetUser API 설명

`GetUser` API는 클라이언트가 서버에 사용자 정보를 요청할 때, 보안성을 유지하면서 사용자 인증 및 세션 유효성을 검증하기 위한 방법을 적용한 API입니다. 이 API는 다음과 같은 방식으로 동작합니다.

## 1. 요청 구조

클라이언트는 두 가지 중요한 정보를 서버로 전달합니다:

- **SessionId**: POST의 Header에 평문으로 전송됩니다. 이 값은 서버가 세션 유효성을 검증하는 데 사용됩니다.
- **EncryptedUserId**: 요청 본문에 포함되며, 이는 로컬에서 안전하게 저장되었던 DPAPI 암호화된 UserId를 복호화한 뒤, 현재 세션의 AES 키를 사용해 다시 암호화하여 전송됩니다.

## 2. 클라이언트 처리 방식

클라이언트는 로컬 저장소에 보관된 DPAPI 암호화된 UserId를 복호화합니다. 이 UserId는 사용자가 로그인할 때 로컬에 안전하게 저장된 값입니다. 복호화 후, 현재 세션에 저장된 AES 키를 사용하여 다시 암호화하고, 이 데이터를 요청 본문에 포함시켜 서버에 전달합니다.

## 3. 서버 처리 방식

서버는 다음 순서로 요청을 처리합니다:

1. **SessionId 검증**: 쿼리 문자열로 전달된 SessionId를 사용해 서버의 세션 저장소에서 세션 정보를 조회하고, 세션의 유효성(만료 여부, IP 일치 여부 등)을 확인합니다.

2. **AES 키 조회 및 복호화**: 검증된 세션 정보에서 AES 키를 조회하고, 이를 사용해 EncryptedUserId를 복호화합니다.

3. **UserId 일치 여부 확인**: 복호화된 UserId가 세션에 저장된 사용자 정보와 일치하는지 확인합니다. 이중 확인을 통해 위조된 요청을 방지할 수 있습니다.

4. **응답 반환**: 검증이 모두 통과되면 해당 UserId에 대한 사용자 정보를 반환하며, 검증에 실패할 경우 적절한 오류를 반환합니다.

## 4. 보안적 이점

- **세션 기반 접근 제어**: 평문으로 전달되는 SessionId는 오직 서버에서만 의미가 있으며, 외부에서 도용해도 내부 AES 키 없이는 사용 불가합니다.
- **이중 인증**: SessionId와 UserId 두 가지를 모두 확인하여 사용자를 검증하므로, 세션 탈취나 위조된 요청을 방지할 수 있습니다.
- **AES + DPAPI 암호화**: 사용자 정보는 로컬에서 안전하게 저장되며, 전송 시에는 AES로 이중 암호화되어 네트워크 상에서도 보호됩니다.

## 5. 결론

이 방식은 단순한 세션 검증을 넘어서, 로컬 암호화 및 전송 암호화의 이중 보호 구조를 제공하여, 사용자 인증 및 데이터 보호 측면에서 높은 수준의 보안을 제공합니다. 이는 민감한 정보를 다루는 시스템이나 클라이언트 보안이 중요한 애플리케이션에서 효과적으로 활용될 수 있습니다.
