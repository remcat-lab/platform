
# Database 설계 및 removed 컬럼 처리 전략

## 1. 설계 배경
- 테이블 데이터: 약 2억 건
- 소프트 삭제용 `removed BIT` 컬럼 추가
- 인덱스는 걸지 않고, 페이징 대신 날짜 범위 검색 방식 선택
- WPF에서 삭제/복구 기능을 제공

---

## 2. removed 컬럼 설계 시 주의사항

### ✅ 성능 관련
- 인덱스 없는 `removed`는 전체 스캔 유발 가능
- 단, 날짜 범위가 매우 협소하다면 문제 없음

### ✅ 데이터 증가 문제
- 삭제 데이터를 물리적으로 삭제하지 않으면 테이블 무한 확장
- 디스크 공간 증가, I/O 성능 저하, 백업/복구 시간 증가

### ✅ 유니크 키 문제
- 소프트 삭제로 인해 유니크 제약 조건 충돌 가능
- 복구 시 충돌 방지 로직 필요

### ✅ 앱 로직 실수 위험
- `removed=0` 조건을 쿼리에서 빠뜨리면 삭제 데이터 노출 가능
- View 또는 ORM 글로벌 필터 권장

### ✅ 복구 시 무결성 문제
- 복구 시 기존 데이터와 충돌 가능
- 복구 전 검증 로직 필요

### ✅ 복잡한 Query 최적화
- 조건마다 항상 `removed=0` 필요
- 인덱스 설계가 없으면 성능 저하

---

## 3. created_at 인덱스만으로 범위 검색 시 성능

### ✅ 성능 충분
- 1주일 범위(평균 1천 건) 조회라면 문제 없음
- 인덱스 레인지 스캔(Index Range Scan)으로 처리

### ⚠️ 주의 사항
- 날짜 범위가 넓어지면 성능 저하 가능성
- deleted 데이터 비율이 증가하면 I/O 증가 가능

| 조건                               | 판단                                     |
|------------------------------------|------------------------------------------|
| 한 번에 조회 데이터가 적다          | ✅ 문제 없음                             |
| removed = 1 비율이 매우 낮다        | ✅ 부담 적음                             |
| 내부 사내망 환경                   | ✅ 무난                                  |
| 개인정보/보안 데이터 없다           | ✅ 안전                                  |
| 대량 데이터 (1만건 이상) 조회       | ⚠️ 비효율 가능                           |
| deleted 데이터가 많음               | ⚠️ 서버 필터 추천                        |

---

## 4. removed 필터를 클라이언트(WPF)에서 처리

### ✅ 장점
- SQL 쿼리 단순화
- 서버 부하 감소
- 인덱스 설계 간소화

### ⚠️ 단점
- 불필요한 데이터 네트워크 전송
- 삭제 데이터가 많으면 효율 저하
- 보안/노출 리스크
- 클라이언트 메모리 부담 증가

### 🔥 현재 판단
- 1주일 범위 조회 + 데이터 소량 → 클라이언트 필터 충분
- deleted 데이터가 많아지면 서버 필터로 전환 준비

---

## 5. 최종 결론 및 추천

| 항목                              | 권장 여부 |
|-----------------------------------|-----------|
| removed 단일 인덱스               | ❌ 현재는 불필요 |
| created_at 단일 인덱스            | ✅ (현재 구조 적합) |
| removed + created_at 복합 인덱스  | ⚙️ 범위가 넓어지면 고려 |
| 하드 딜리트 배치                  | ✅ 디스크 관리 차원 |
| View 또는 ORM 글로벌 필터          | ✅ 버그 예방 |
| Partition (created_at 기준)       | ⚙️ 초대형 테이블 고려 |
| 복구 시 데이터 무결성 검사         | ✅ 반드시 필요 |

---

## 6. 추천 쿼리 예시

### ▶️ 현재 구조 (클라이언트 필터)
```sql
SELECT * 
FROM table 
WHERE created_at BETWEEN '2025-06-01' AND '2025-06-07';
```

### ▶️ 필요 시 서버 필터 적용
```sql
SELECT * 
FROM table 
WHERE created_at BETWEEN '2025-06-01' AND '2025-06-07'
  AND removed = 0;
```
