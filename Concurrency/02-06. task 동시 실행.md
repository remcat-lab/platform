# C# Task OrderByCompletion 패턴과 전체 소요 시간 분석

## ✅ 기본 상황

3개의 Task를 동시에 실행하고, 완료되는 순서대로 결과를 처리하는 패턴.

```csharp
var tasks = new[]
{
    Task.Delay(3000).ContinueWith(_ => "A"), // 3초
    Task.Delay(1000).ContinueWith(_ => "B"), // 1초
    Task.Delay(2000).ContinueWith(_ => "C")  // 2초
};
```

## ✅ 순차적으로 await하면?

```csharp
foreach (var task in tasks)
{
    Console.WriteLine(await task);
}
```

- 각 Task가 순서대로 기다림
- 총 소요 시간 = 3초 + 1초 + 2초 = **6초**

## ✅ OrderByCompletion 패턴 사용 시

### ✔️ 구현 예시

```csharp
public static async IAsyncEnumerable<Task<T>> OrderByCompletion<T>(IEnumerable<Task<T>> tasks)
{
    var taskList = tasks.ToList();

    while (taskList.Any())
    {
        var finished = await Task.WhenAny(taskList);
        yield return finished;
        taskList.Remove(finished);
    }
}
```

### ✔️ 사용 예시

```csharp
var tasks = new[]
{
    Task.Delay(3000).ContinueWith(_ => "A"),
    Task.Delay(1000).ContinueWith(_ => "B"),
    Task.Delay(2000).ContinueWith(_ => "C")
};

var sw = Stopwatch.StartNew();

await foreach (var task in OrderByCompletion(tasks))
{
    Console.WriteLine($"{sw.Elapsed.TotalSeconds:N1}s: {await task}");
}
```

### ✔️ 출력 결과

```
1.0s: B
2.0s: C
3.0s: A
```

## ✅ 전체 소요 시간

- **동시에 시작**
- 가장 오래 걸리는 작업 기준으로 종료
- ✅ **전체 소요 시간: 3초**

## ✅ 요약 비교

| 방식 | 동작 방식 | 전체 소요 시간 |
|------|-----------|----------------|
| `foreach (await)` | 순차 실행 | 6초 |
| `OrderByCompletion` | 동시 실행, 완료 순 처리 | 3초 |
| `Task.WhenAll` | 동시 실행, 모두 완료 후 처리 | 3초 |

## ✅ 참고

- ✔️ `OrderByCompletion`은 중간 결과를 바로바로 처리 가능
- ✔️ `Task.WhenAll`은 전체 완료 후 한 번에 결과 반환
- ✔️ CPU 작업은 `Parallel.ForEach`로 병렬 처리하는 것이 효율적
