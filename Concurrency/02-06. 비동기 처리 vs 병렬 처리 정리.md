
# C# ë¹„ë™ê¸° ì²˜ë¦¬ vs ë³‘ë ¬ ì²˜ë¦¬ ì •ë¦¬

## âœ… ë¬¸ì œ ìƒí™©

```csharp
var tasks = new[] { Task1(), Task2(), Task3() };

foreach (var task in tasks)
{
    Console.WriteLine(await task);
}
```

- ìœ„ ì½”ë“œëŠ” `Task1` â†’ `Task2` â†’ `Task3` ìˆœì„œë¡œ ì‹¤í–‰ë¨.
- ì´ìœ : foreachì—ì„œ awaitë¥¼ í•˜ë©´ í•´ë‹¹ ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê³  ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°.
- ì¦‰, ë¹„ë™ê¸°ë¡œ ì‘ì„±í–ˆì§€ë§Œ **ë™ê¸°ì  ìˆœì°¨ ì‹¤í–‰**.

---

## âœ… ì™„ë£Œ ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•

### ğŸ”¸ ë°©ë²• 1: Task.WhenAny ë£¨í”„

```csharp
var tasks = new List<Task<string>> { Task1(), Task2(), Task3() };

while (tasks.Count > 0)
{
    var finished = await Task.WhenAny(tasks);
    tasks.Remove(finished);

    var result = await finished;
    Console.WriteLine(result);
}
```

- âœ”ï¸ ì„¸ ê°œì˜ ì‘ì—…ì´ ë™ì‹œì— ì‹¤í–‰ë¨.
- âœ”ï¸ ì™„ë£Œëœ ê²ƒë¶€í„° ìˆœì„œëŒ€ë¡œ ì¶œë ¥.

---

### ğŸ”¸ ë°©ë²• 2: OrderByCompletion íŒ¨í„´

```csharp
public static async IAsyncEnumerable<Task<T>> OrderByCompletion<T>(IEnumerable<Task<T>> tasks)
{
    var taskList = tasks.ToList();
    while (taskList.Count > 0)
    {
        var finished = await Task.WhenAny(taskList);
        taskList.Remove(finished);
        yield return finished;
    }
}
```

#### ì‚¬ìš© ì˜ˆì‹œ:

```csharp
var tasks = new[] { Task1(), Task2(), Task3() };

await foreach (var completed in OrderByCompletion(tasks))
{
    var result = await completed;
    Console.WriteLine(result);
}
```

- âœ”ï¸ ê°€ë…ì„±ì´ ë†’ìŒ.
- âœ”ï¸ ì™„ë£Œëœ ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬ ê°€ëŠ¥.
- â— C# 8 ì´ìƒ í•„ìš”.

---

### ğŸ”¸ ë°©ë²• 3: Task.WhenAll

```csharp
var tasks = new[] { Task1(), Task2(), Task3() };
var results = await Task.WhenAll(tasks);

foreach (var result in results)
{
    Console.WriteLine(result);
}
```

- âœ”ï¸ ì „ì²´ê°€ ëë‚œ í›„ì— ê²°ê³¼ë¥¼ ìˆœì„œëŒ€ë¡œ ì¶œë ¥.
- âŒ ì™„ë£Œ ìˆœì„œì™€ëŠ” ë¬´ê´€ (tasks ë°°ì—´ ìˆœì„œ).

---

## âœ… ë¹„ë™ê¸° ëŒ€ì‹  ë³‘ë ¬ ì²˜ë¦¬?

### ğŸ”¸ Parallel.ForEach (CPU ë°”ìš´ë“œì— ì í•©)

```csharp
var items = new[] {1, 2, 3};

Parallel.ForEach(items, item =>
{
    var result = DoWork(item); // ë™ê¸° ë©”ì„œë“œ
    Console.WriteLine(result);
});
```

- âœ”ï¸ CPU ë°”ìš´ë“œì— ê°•ë ¥.
- âŒ IO ë°”ìš´ë“œ (ë„¤íŠ¸ì›Œí¬, ë””ìŠ¤í¬ ë“±)ì—ëŠ” ë¹„íš¨ìœ¨ì .

### ğŸ”¸ Task.Run + Task.WhenAny

```csharp
var tasks = items.Select(item => Task.Run(() => DoWork(item))).ToList();

while (tasks.Count > 0)
{
    var finished = await Task.WhenAny(tasks);
    tasks.Remove(finished);

    Console.WriteLine(await finished);
}
```

- âœ”ï¸ ë™ê¸° ì‘ì—…ì„ ë¹„ë™ê¸°ë¡œ ë˜í•‘í•´ì„œ ë™ì‹œì— ì²˜ë¦¬.

---

## âœ… ì •ë¦¬

| ì‘ì—… ì¢…ë¥˜ | ì¶”ì²œ ë°©ì‹ |
|----------|-----------|
| IO ë°”ìš´ë“œ | Task.WhenAll, OrderByCompletion, async/await |
| CPU ë°”ìš´ë“œ | Parallel.ForEach, ThreadPool, Task.Run |
| ì™„ë£Œ ìˆœì„œ ì¤‘ìš” | Task.WhenAny ë°˜ë³µ, OrderByCompletion |
| ì „ì²´ ì™„ë£Œ í›„ ì²˜ë¦¬ | Task.WhenAll |

---

## âœ… ê²°ë¡ 

- IO ë°”ìš´ë“œ â†’ async/await ê¸°ë°˜ Taskê°€ íš¨ìœ¨ì .
- CPU ë°”ìš´ë“œ â†’ ë³‘ë ¬ ì²˜ë¦¬ (`Parallel.ForEach`)ê°€ íš¨ìœ¨ì .
- ì™„ë£Œ ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬ â†’ `Task.WhenAny` ë˜ëŠ” `OrderByCompletion` ì‚¬ìš©.
- ìƒí™©ì— ë§ê²Œ ë¹„ë™ê¸°ì™€ ë³‘ë ¬ì„ ì„ íƒ.


# C# Task OrderByCompletion íŒ¨í„´ê³¼ ì „ì²´ ì†Œìš” ì‹œê°„ ë¶„ì„

## âœ… ê¸°ë³¸ ìƒí™©

3ê°œì˜ Taskë¥¼ ë™ì‹œì— ì‹¤í–‰í•˜ê³ , ì™„ë£Œë˜ëŠ” ìˆœì„œëŒ€ë¡œ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ëŠ” íŒ¨í„´.

```csharp
var tasks = new[]
{
    Task.Delay(3000).ContinueWith(_ => "A"), // 3ì´ˆ
    Task.Delay(1000).ContinueWith(_ => "B"), // 1ì´ˆ
    Task.Delay(2000).ContinueWith(_ => "C")  // 2ì´ˆ
};
```

## âœ… ìˆœì°¨ì ìœ¼ë¡œ awaití•˜ë©´?

```csharp
foreach (var task in tasks)
{
    Console.WriteLine(await task);
}
```

- ê° Taskê°€ ìˆœì„œëŒ€ë¡œ ê¸°ë‹¤ë¦¼
- ì´ ì†Œìš” ì‹œê°„ = 3ì´ˆ + 1ì´ˆ + 2ì´ˆ = **6ì´ˆ**

## âœ… OrderByCompletion íŒ¨í„´ ì‚¬ìš© ì‹œ

### âœ”ï¸ êµ¬í˜„ ì˜ˆì‹œ

```csharp
public static async IAsyncEnumerable<Task<T>> OrderByCompletion<T>(IEnumerable<Task<T>> tasks)
{
    var taskList = tasks.ToList();

    while (taskList.Any())
    {
        var finished = await Task.WhenAny(taskList);
        yield return finished;
        taskList.Remove(finished);
    }
}
```

### âœ”ï¸ ì‚¬ìš© ì˜ˆì‹œ

```csharp
var tasks = new[]
{
    Task.Delay(3000).ContinueWith(_ => "A"),
    Task.Delay(1000).ContinueWith(_ => "B"),
    Task.Delay(2000).ContinueWith(_ => "C")
};

var sw = Stopwatch.StartNew();

await foreach (var task in OrderByCompletion(tasks))
{
    Console.WriteLine($"{sw.Elapsed.TotalSeconds:N1}s: {await task}");
}
```

### âœ”ï¸ ì¶œë ¥ ê²°ê³¼

```
1.0s: B
2.0s: C
3.0s: A
```

## âœ… ì „ì²´ ì†Œìš” ì‹œê°„

- **ë™ì‹œì— ì‹œì‘**
- ê°€ì¥ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—… ê¸°ì¤€ìœ¼ë¡œ ì¢…ë£Œ
- âœ… **ì „ì²´ ì†Œìš” ì‹œê°„: 3ì´ˆ**

## âœ… ìš”ì•½ ë¹„êµ

| ë°©ì‹ | ë™ì‘ ë°©ì‹ | ì „ì²´ ì†Œìš” ì‹œê°„ |
|------|-----------|----------------|
| `foreach (await)` | ìˆœì°¨ ì‹¤í–‰ | 6ì´ˆ |
| `OrderByCompletion` | ë™ì‹œ ì‹¤í–‰, ì™„ë£Œ ìˆœ ì²˜ë¦¬ | 3ì´ˆ |
| `Task.WhenAll` | ë™ì‹œ ì‹¤í–‰, ëª¨ë‘ ì™„ë£Œ í›„ ì²˜ë¦¬ | 3ì´ˆ |

## âœ… ì°¸ê³ 

- âœ”ï¸ `OrderByCompletion`ì€ ì¤‘ê°„ ê²°ê³¼ë¥¼ ë°”ë¡œë°”ë¡œ ì²˜ë¦¬ ê°€ëŠ¥
- âœ”ï¸ `Task.WhenAll`ì€ ì „ì²´ ì™„ë£Œ í›„ í•œ ë²ˆì— ê²°ê³¼ ë°˜í™˜
- âœ”ï¸ CPU ì‘ì—…ì€ `Parallel.ForEach`ë¡œ ë³‘ë ¬ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ íš¨ìœ¨ì 
